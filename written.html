<script>
  let eventChoices;
  let subEventChoices;

  const subEventMap = {
    projectManagement: ['PMBS', 'PMCD', 'PMCA'],
    entrepreneurship: ['EBG', 'EFB'],
    operationResearch: ['BOR', 'BMOR']
  };

  const subEventLabels = {
    PMBS: 'Project Management: Business Solutions',
    PMCD: 'Project Management: Career Development',
    PMCA: 'Project Management: Community Awareness',
    EBG: 'Entrepreneurship: Business Growth Plan',
    EFB: 'Entrepreneurship: Franchise Business Plan',
    BOR: 'Business Operations Research',
    BMOR: 'Business Management and Administration OR'
  };

  const fileMap = {
    PMCA: ['PMCA 1.pdf', 'PMCA 2.pdf', 'PMCA 3.pdf'],
    PMBS: ['PMBS 1.pdf', 'PMBS 2.pdf'],
    EBG: ['EBG 1.pdf'],
    BOR: ['BOR 1.pdf']
  };

  const eventTypeEl = document.getElementById('eventType');
  const subEventEl = document.getElementById('subEvent');
  const resultsEl = document.getElementById('results');
  const subDescEl = document.getElementById('subDesc');
  const pdfViewer = document.getElementById('pdfViewer');

  eventChoices = new Choices('#eventType', { searchEnabled: true });
  subEventChoices = new Choices('#subEvent', { searchEnabled: true });

  eventTypeEl.addEventListener('change', (e) => {
    const selected = e.target.value;
    subDescEl.textContent = '';
    pdfViewer.style.display = 'none';
    resultsEl.innerHTML = '';

    subEventChoices.clearStore(); // clear previous options
    subEventChoices.clearChoices();

    if (subEventMap[selected]) {
      const newOptions = subEventMap[selected].map(code => ({
        value: code,
        label: subEventLabels[code] || code,
        selected: false,
        disabled: false
      }));
      subEventChoices.setChoices(newOptions, 'value', 'label', true);
    } else {
      subEventChoices.setChoices([{ value: '', label: '-- No options --', disabled: true }], 'value', 'label', true);
    }
  });

  subEventEl.addEventListener('change', () => {
    const selectedSub = subEventEl.value;
    subDescEl.textContent = subEventLabels[selectedSub] || '';
    resultsEl.innerHTML = '';
    pdfViewer.style.display = 'none';
  });

  function showExamples() {
    const subEvent = subEventEl.value;
    resultsEl.innerHTML = '';
    pdfViewer.style.display = 'none';

    const files = fileMap[subEvent];
    if (!files) {
      resultsEl.textContent = 'No files available.';
      return;
    }

    files.forEach(file => {
      const wrapper = document.createElement('div');
      wrapper.className = 'file-entry';

      const viewLink = document.createElement('a');
      viewLink.href = `./pdfs/${file}`;
      viewLink.innerHTML = `<i class="fas fa-file-pdf"></i> ${file}`;
      viewLink.onclick = (e) => {
        e.preventDefault();
        pdfViewer.src = `./pdfs/${file}`;
        pdfViewer.style.display = 'block';
      };

      const downloadBtn = document.createElement('a');
      downloadBtn.href = `./pdfs/${file}`;
      downloadBtn.download = file;
      downloadBtn.className = 'download';
      downloadBtn.innerHTML = '<i class="fas fa-download"></i>';

      wrapper.appendChild(viewLink);
      wrapper.appendChild(downloadBtn);
      resultsEl.appendChild(wrapper);
    });
  }
</script>
